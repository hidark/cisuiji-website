# 词随记第二阶段开发计划

## 🎯 开发策略与优先级

### 核心策略：**体验优先，性能并重**
基于第一阶段MVP的用户反馈和专家建议，第二阶段聚焦**从能用到好用**的转变。

## 📊 功能优先级矩阵

| 功能模块 | 用户影响 | 开发复杂度 | 优先级 | 预计工时 |
|---------|---------|-----------|--------|----------|
| **卡片式复习系统** | 🔥🔥🔥 | 🔧🔧 | P0 | 5天 |
| **进度可视化** | 🔥🔥🔥 | 🔧🔧🔧 | P0 | 4天 |
| **深色模式** | 🔥🔥 | 🔧 | P0 | 2天 |
| **搜索筛选** | 🔥🔥 | 🔧 | P0 | 2天 |
| **性能优化** | 🔥🔥 | 🔧🔧🔧 | P1 | 3天 |
| **批量操作** | 🔥 | 🔧 | P1 | 2天 |
| **设置页面** | 🔥 | 🔧 | P1 | 2天 |
| **数据导入导出** | 🔥 | 🔧🔧 | P2 | 2天 |
| **音频发音** | 🔥 | 🔧 | P2 | 2天 |

## 🏗️ 技术架构决策

### 1. **状态管理升级**
```typescript
// 选择 Zustand - 轻量级，适合Chrome扩展
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface AppState {
  // 复习状态
  reviewSession: ReviewSession | null;
  currentCard: number;
  reviewMode: ReviewMode;
  
  // 界面状态  
  theme: 'light' | 'dark' | 'auto';
  searchQuery: string;
  selectedWords: string[];
  
  // 数据状态
  words: WordEntry[];
  statistics: LearningStats;
  settings: Settings;
}
```

### 2. **组件架构重构**
```
src/
├── components/           # 可复用组件
│   ├── ui/              # 基础UI组件
│   │   ├── Button/
│   │   ├── Card/
│   │   ├── Modal/
│   │   └── Charts/
│   ├── features/        # 功能组件
│   │   ├── ReviewCard/
│   │   ├── WordList/
│   │   ├── SearchBox/
│   │   └── StatsPanel/
├── hooks/               # 自定义钩子
│   ├── useVirtualScroll.ts
│   ├── useLocalStorage.ts
│   └── useKeyboard.ts
├── stores/              # 状态管理
│   ├── reviewStore.ts
│   ├── wordsStore.ts
│   └── settingsStore.ts
└── utils/               # 工具函数
    ├── animations.ts
    ├── keyboard.ts
    └── performance.ts
```

### 3. **性能优化策略**
```typescript
// 虚拟滚动实现
export function useVirtualScroll<T>({
  items,
  itemHeight,
  containerHeight,
  overscan = 5
}: VirtualScrollOptions<T>) {
  const [scrollTop, setScrollTop] = useState(0);
  
  const visibleRange = useMemo(() => {
    const start = Math.max(0, Math.floor(scrollTop / itemHeight) - overscan);
    const end = Math.min(
      items.length,
      Math.ceil((scrollTop + containerHeight) / itemHeight) + overscan
    );
    return { start, end };
  }, [scrollTop, items.length, itemHeight, containerHeight, overscan]);
  
  return {
    visibleItems: items.slice(visibleRange.start, visibleRange.end),
    totalHeight: items.length * itemHeight,
    offsetY: visibleRange.start * itemHeight,
    setScrollTop
  };
}
```

## 📅 详细开发计划

### **Phase 2.1 - 复习体验重构 (Week 1)**

#### Day 1-2: 卡片组件基础架构
**目标**: 建立新的复习系统架构
```typescript
// 实现内容
interface ReviewCard {
  id: string;
  word: WordEntry;
  isFlipped: boolean;
  showingAnswer: boolean;
  userRating?: ReviewRating;
}

interface ReviewSession {
  cards: ReviewCard[];
  currentIndex: number;
  mode: 'study' | 'rapid' | 'test';
  startTime: number;
  stats: SessionStats;
}
```

**交付物**:
- `ReviewCard` 组件（卡片翻转动画）
- `ReviewSession` 状态管理
- 基础的卡片切换逻辑

#### Day 3-4: 复习流程和交互
**目标**: 实现完整的复习学习流程
```typescript
// 复习模式
enum ReviewMode {
  Study = 'study',     // 学习模式：显示释义
  Test = 'test',       // 测试模式：先思考再显示
  Rapid = 'rapid'      // 快速模式：减少动画延迟
}
```

**交付物**:
- 三种复习模式切换
- 记忆测试流程（隐藏→思考→显示→评分）
- 进度指示器和剩余数量显示

#### Day 5-7: 快捷键和细节优化
**目标**: 提升操作效率和用户体验

**快捷键方案**:
```typescript
const reviewHotkeys = {
  'Space': '翻转卡片/显示答案',
  '1': '再来(Again)', 
  '2': '困难(Hard)',
  '3': '一般(Good)',
  '4': '简单(Easy)',
  'ArrowLeft': '上一张卡片',
  'ArrowRight': '下一张卡片',
  'Escape': '退出复习'
};
```

**交付物**:
- 完整的快捷键系统
- 复习完成统计页面
- 动画和微交互优化

### **Phase 2.2 - 数据可视化 (Week 2)**

#### Day 1-2: 学习数据建模
**目标**: 设计和实现学习统计数据结构

```typescript
interface LearningStats {
  // 基础统计
  totalWords: number;
  masteredWords: number;
  reviewAccuracy: number;
  
  // 时间维度统计  
  dailyStats: DailyStats[];
  weeklyTrend: WeeklyTrend;
  
  // 掌握度分析
  masteryDistribution: MasteryLevel[];
  difficultyAnalysis: DifficultyStats;
  
  // 成就数据
  streakDays: number;
  achievements: Achievement[];
  milestones: Milestone[];
}
```

#### Day 3-4: 图表组件实现
**技术选择**: Chart.js (轻量) 或 自建简单图表

```typescript
// 图表类型
- PieChart: 掌握度分布
- LineChart: 学习曲线  
- HeatMap: 学习活跃度
- BarChart: 每日复习数据
- ProgressRing: 今日进度
```

#### Day 5: 学习仪表盘整合
**目标**: 创建综合的学习数据可视化界面

### **Phase 2.3 - 界面现代化 (Week 2 后半)**

#### Day 6-7: 深色模式和主题系统
```css
/* CSS变量主题系统 */
[data-theme="light"] {
  --bg-primary: #ffffff;
  --bg-secondary: #f9fafb;
  --text-primary: #111827;
  --accent: #667eea;
}

[data-theme="dark"] {
  --bg-primary: #1f2937;
  --bg-secondary: #111827;
  --text-primary: #f9fafb;
  --accent: #818cf8;
}
```

### **Phase 2.4 - 搜索和性能 (Week 3)**

#### Day 1-2: 搜索筛选系统
```typescript
interface SearchOptions {
  query: string;
  filters: {
    status?: WordStatus[];
    source?: string[];
    dateRange?: [Date, Date];
    difficulty?: DifficultyLevel[];
  };
  sortBy: 'date' | 'alphabetical' | 'frequency';
  sortOrder: 'asc' | 'desc';
}
```

#### Day 3-5: 性能优化
- 虚拟滚动实现
- 图片和数据懒加载
- 防抖搜索
- 缓存策略优化

### **Phase 2.5 - 功能完善 (Week 4)**

#### Day 1-2: 批量操作
- 多选界面
- 批量删除、标记、导出
- 操作撤销功能

#### Day 3-4: 设置页面
- 个性化配置界面
- 数据管理功能
- 高级设置选项

#### Day 5-7: 数据导入导出和音频
- CSV/JSON导入导出
- 浏览器TTS集成
- 发音按钮和自动播放

## 🧪 测试策略

### 1. **开发过程测试**
```typescript
// 单元测试重点
- 复习算法逻辑
- 数据统计计算  
- 搜索筛选功能
- 导入导出功能

// 集成测试重点
- 复习流程完整性
- 数据持久化
- 快捷键系统
- 主题切换
```

### 2. **性能基准测试**
```typescript
// 性能指标
const performanceTargets = {
  firstContentfulPaint: '<300ms',
  largeContentfulPaint: '<800ms', 
  totalBlockingTime: '<100ms',
  cumulativeLayoutShift: '<0.1',
  
  // 功能性能
  searchResponse: '<50ms',
  cardFlipAnimation: '60fps',
  virtualScrollFps: '60fps',
  memoryUsage: '<80MB'
};
```

### 3. **用户体验测试**
- 复习流程可用性测试
- 快捷键学习曲线测试
- 大数据量性能测试 (1000+ words)
- 不同屏幕尺寸适配测试

## 🎯 成功标准

### 定量指标
- **性能**: 所有交互响应时间 < 100ms
- **体验**: 复习完成率 > 90%
- **稳定性**: 零crash，内存使用 < 80MB
- **质量**: 代码覆盖率 > 85%

### 定性指标
- **视觉**: 现代化、一致性的界面设计
- **交互**: 流畅的动画和即时反馈
- **学习**: 有效的记忆测试和进度追踪
- **效率**: 支持键盘操作和批量管理

## ⚠️ 风险缓解

### 开发风险
1. **复杂度控制**: MVP优先，高级功能可选
2. **性能风险**: 分阶段压力测试，及时优化
3. **兼容性**: 在多个Chrome版本测试

### 产品风险  
1. **用户习惯**: 渐进式改进，保持向后兼容
2. **功能膨胀**: 严格按优先级开发，避免feature creep
3. **质量保证**: 每周末进行完整测试和演示

---

## 🚀 启动准备

### 下一步行动
1. **确认计划**: 评审开发计划和时间安排
2. **环境准备**: 安装依赖和开发工具
3. **架构搭建**: 创建基础组件和状态管理
4. **启动开发**: 开始第一个功能模块

### 依赖和工具
```json
{
  "dependencies": {
    "zustand": "^4.4.0",
    "chart.js": "^4.4.0", 
    "react-chartjs-2": "^5.2.0",
    "framer-motion": "^10.16.0"
  },
  "devDependencies": {
    "@testing-library/react": "^13.4.0",
    "@testing-library/user-event": "^14.5.0"
  }
}
```

**准备好开始第二阶段开发了吗？** 🎯