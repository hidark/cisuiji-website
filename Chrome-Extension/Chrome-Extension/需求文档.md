## 需求文档（PRD）— 词随记 Chrome 扩展

### 产品概述
- **产品名称**: 词随记（Chrome 扩展）
- **一句话目标**: 在浏览网页时，划词一键加入单词本，自动拉取简明释义与添加时间，按计划提醒复习，学会后可标记完成。

### 目标与价值
- **降低添加门槛**: 划词右键/快捷键即收录。
- **轻负担复习**: 内置简化间隔复习算法，自动提醒。
- **可见进度**: 待复习、已学会清晰分层，支持统计与导出。

### 用户画像与场景
- **对象**: 英语学习者、阅读英文资料的学生/从业者。
- **场景**: 浏览文章/论文/社媒时遇到生词，想快速记忆与后续复习。

### 功能范围
- **Must（v1.0）**
  - **划词收录**: 右键菜单/快捷键（如 Alt+S）将选中文本加入单词本；去重与来源合并。
  - **释义获取**: 在线词典（如 `dictionaryapi.dev`）+ 本地兜底词库；记录 `addedAt`。
  - **单词本与复习**: 待复习/已学会列表；三档打分（掌握/模糊/错误）。
  - **提醒**: 在可设置时间窗内推送通知；点击进入复习。
  - **数据**: 导出/导入 CSV/JSON；基础统计（总量/今日完成/连胜）。
  - **设置**: 数据源、复习强度、每日上限、通知时间窗。
- **Should**
  - 来源聚合（标题与 URL）、卡片模式复习、基础 i18n（中文优先）。
- **Won't（首版不含）**
  - 云同步、账号体系、多语学习、音频/例句（后续版本）。

### 用户故事与验收标准（节选）
- **划词加词**: 我划词→右键“加入单词本”，0.3s 内得到成功反馈；释义异步更新。
  - 验收：成功率≥99%；重复加入不创建重复项；离线使用本地兜底。
- **复习打分**: 我在弹窗查看待复习清单，对每个词“掌握/模糊/错误”。
  - 验收：打分即刻重算 `dueAt/interval/ease/streak` 并持久化。
- **通知点击**: 在通知时间窗内收到提醒，点击进入复习。
  - 验收：通知在时间窗内触发；点击打开扩展并定位待复习。
- **标记学会**: 我可以将词标记为“已学会”，默认不再进入待复习。
  - 验收：状态从 `learning`→`learned`；除非设置开启巩固。
- **导入/导出**: 支持 CSV/JSON。
  - 验收：字段覆盖核心模型；非法输入有提示与保护。

### 非功能需求
- **隐私**: 默认仅本地存储（`chrome.storage.local`），后续可选 `sync`。
- **性能**: 划词→加入反馈<300ms（释义异步）；网络超时<3s，失败可重试。
- **稳定**: 失败回退、指数退避；MV3 兼容最新 Chrome。

### 数据模型
- **WordEntry**
  - `id`: string（slug：单词+语言）
  - `text`: string（单词）
  - `language`: string（如 en）
  - `definition`: string（简明释义）
  - `partOfSpeech`: string[]
  - `source`: { `title`: string, `url`: string }[]
  - `addedAt`: number（时间戳）
  - `status`: "learning" | "learned" | "deleted"
  - `review`: { `dueAt`: number, `intervalDays`: number, `ease`: number, `streak`: number, `lastReviewedAt`: number|null }
- **Settings**
  - `dictionarySource`: "dictionaryapi" | "youdao" | "localFallback"
  - `dailyReviewLimit`: number（默认 30）
  - `notifyEnabled`: boolean（默认 true）
  - `notifyWindow`: { `start`: "08:00", `end`: "22:00" }
  - `reviewStrength`: "gentle" | "standard" | "intense"
  - `language`: "zh-CN" | "en-US"

### 复习算法（简化 SRS）
- **初始**: 新词当日 `dueAt`；`intervalDays = 0`，`ease = 2.5`。
- **掌握**: `streak += 1`；`ease = max(1.3, ease + 0.1 - 0.08*(1 - 0.8))`；`intervalDays = intervalDays == 0 ? 1 : round(intervalDays * ease)`。
- **模糊**: 质量分 0.6，小幅增长；`ease` 小降。
- **错误**: `streak = 0`，`intervalDays = 0 或 1`，`ease = max(1.3, ease - 0.2)`。
- **下一次**: `dueAt = now + intervalDays`（天）。

### 权限与清单
- **必须权限**: `contextMenus`, `storage`, `notifications`, `alarms`, `activeTab`
- **可选权限**: `scripting`, `tabs`
- **主机权限**: 词典 API 域名白名单

### 风险与应对
- **词典 API 限流/失败**: 结果缓存 + 本地兜底 + 超时与退避。
- **通知被关闭**: 弹窗内红点提醒 + 角标提示。
- **多义项质量**: 摘取 1–2 条简明释义，支持手动编辑（后续版本）。

### 成功指标（KPI）
- **留存**: D1 保留率、7 日复习完成率。
- **行为**: 日均新增词数、日均复习词数、通知点击率。
- **质量**: 释义失败率、重复率、错误率。

### 版本规划（里程碑）
- **v0.1 原型（1–2 周）**: 划词加入、基础存储、在线词典 + 本地兜底、Popup 全部列表。
- **v0.2 复习基础（1–2 周）**: 简化 SRS、待复习清单、三档打分、通知与时间窗、今日上限。
- **v0.3 设置与导出（1 周）**: 设置页、导入/导出、统计。
- **v1.0 发布（1 周）**: 性能与错误处理、i18n、隐私说明、上架素材。

### v1.0 验收标准
- 划词→右键→加入成功率≥99%，重复加入不重复。
- 在线释义命中率≥90%；失败自动回退，本地兜底覆盖≥80%高频词。
- 通知在设置时间窗内发送且可点击进入复习。
- SRS 计算准确，`review` 字段变更正确并持久化。
- 标记“已学会”后默认不再入队（除非开启巩固）。
- UI 无崩溃，交互响应<100ms，加入反馈<300ms。


