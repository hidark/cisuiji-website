## 测试文档（Test Plan）— 词随记

### 测试策略
- **单元测试**: SRS 计算、去重/合并、CSV/JSON 转换、字典响应解析与超时处理。
- **集成测试**: 后台消息流（content↔background）、存储一致性、超时/回退逻辑、通知触发与点击。
- **端到端（E2E）**: 选词→加入→释义更新→复习打分→通知点击→标记学会。
- **手工测试**: MV3 权限弹窗、不同站点/SPA 页面行为、网络异常与限流。

### 测试环境
- **平台**: Windows 10+，最新 Chrome 桌面版。
- **加载方式**: 开发者模式加载 `dist/` 目录。
- **Mock**: 词典 API 的正常/失败/限流三类响应。

### 用例与预期（节选）
- **加词成功（在线）**: 加入后 300ms 内反馈成功；释义随后更新为在线来源。
- **加词超时回退（离线）**: 超时 3s 或网络错误时使用本地兜底释义，并标注来源=local。
- **重复加词合并**: 同一单词再次加入：不新增条目；来源追加当前页信息；复习进度不回退。
- **复习三档打分**: 掌握/模糊/错误分别导致 `streak/ease/intervalDays/dueAt` 按算法更新；`lastReviewedAt` 更新时间戳。
- **通知与时间窗**: 在 `notifyWindow` 内产生通知；窗口外不推送；点击打开弹窗并定位到待复习。
- **导出/导入**: 导出 CSV/JSON 字段完整；导入非法格式给出提示并不破坏既有数据。
- **设置生效**: 切换数据源后新加词走新源；调整每日上限/时间窗后行为即刻生效。
- **状态迁移**: `learning`→`learned` 后默认不再进入待复习队列。

### 自动化与覆盖率
- **单测**: Vitest/Jest 覆盖核心模块≥80%。
- **E2E**: Puppeteer/ChromeDriver 自动加载扩展、注入选词、触发右键菜单、模拟通知点击。
- **CI 建议**: 在 PR 上运行单测与关键路径 E2E（本地/容器化 Chrome）。

### 性能与稳定性标准
- **加词反馈**: <300ms（不含在线释义）。
- **网络策略**: 超时 3s；指数退避≤3 次；失败回退有提示。
- **资源占用**: 后台轻量运行，不阻塞页面主线程。

### 回归清单
- MV3 `manifest` 字段与权限；`storage` 结构；通知与闹钟；SRS 计算；导入导出；i18n 开关；快捷键与右键菜单。

### 验收标准（v1.0）
- 满足 PRD 的 v1.0 验收项：加词成功率、释义命中率、通知点击复习可达、SRS 正确、学会状态不再入队、UI 响应与稳定性达标。


